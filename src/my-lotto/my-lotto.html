<!--
Authors: Michael Ames, Zachary Hern
Version: December 2017
This work may be modified and redistributed.
We ask only that you give the authors credit.
-->

<!-- Layout adapted from https://github.com/PolymerElements/app-layout/blob/master/templates/test-drive/test-app.html -->
<head>
    <link rel="import" href="../../bower_components/polymer/polymer-element.html">
    <link rel="import" href="../../bower_components/app-layout/app-layout.html">
    <link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
    <link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
    <link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
    <link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
    <link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
    <link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
    <link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
    <link rel="import" href="../../bower_components/paper-card/paper-card.html">
    <link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
    <link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
    <link rel="import" href="../../bower_components/iron-iconset-svg/iron-iconset-svg.html">
    <link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
    <link rel="import" href="../../bower_components/paper-button/paper-button.html">
    <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
    <link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
    <link rel="import" href="../../bower_components/paper-item/paper-item.html">
    <link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
    <link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
    <link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
    <link rel="import" href="../../bower_components/polymerfire/firebase.html">
    <link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
    <link rel="import" href="../../bower_components/paper-range-slider/paper-range-slider.html">
    <link rel="import" href="../../bower_components/neon-animation/web-animations.html">
    <script src="../../bower_components/web-animations-js/web-animations.min.js"></script>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKb-lSY4lMIiiy014YHhf9pwJOejs2YYU"
            async defer>
    </script>

    <!--Firebase data-->
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>

    <!--Firebase Auth-->
    <script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css"/>

    <!--Chart.js-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

    <!--jQuery-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!--include custom style module-->
    <link rel="import" href="styles.html">


    <iron-iconset-svg name="app" size="24">
        <svg>
            <defs>
                <g id="menu">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
                </g>
            </defs>
        </svg>
    </iron-iconset-svg>


    <!-- global variables -->
    <script>
        var rootRef;
        incomeValues = [[0, 20000], [20000, 35000], [35000, 50000], [50000, Number.MAX_VALUE]];
        raceValues = [[0, 10], [10, 20], [20, 30], [30, 50], [50, 100]];
        ratioValues = [[0, 2], [2, 4], [4, 6], [6, 8], [8, 10], [10, 14], [14, 23]];
        var map;
        var barChart;
        var demoChart;
        var ui;
        var nonau;
        var au;
        var signInContainer;
        var currentUid;
        var currentUser;

        //slider tracker variables
        var incomeMin = 0;
        var incomeMax = 100;
            var whiteMin, whiteMax, asianMin, asianMax, blackMin, blackMax, latinoMin, latinoMax, spentReceivedMin, spentReceivedMax;

        var currentDistrict;
        /*var provider = new firebase.auth.GoogleAuthProvider();*/
    </script>


    <dom-module id="my-lotto">
        <!-- Note, you cannot make a reference to templated elements within the template. Any refrences must be done in
        the ready method, or in a function in the main script section-->
        <template>

            <style include="iron-flex iron-flex-alignment"></style>
            <style include="my-style-module"></style>

            <firebase-app id="myFireApp" api-key=”AIzaSyDKKJTf4YSeMypo9ciQYM9CqnNB8lVTHBg”
                          auth-domain=”lotterydata-2fe33.firebaseapp.com”
                          database-url=”https://lotterydata-2fe33.firebaseio.com></firebase-app>
            </firebase-app>


            <!--query for all district names-->
            <firebase-query id="districtNameFiller" path="districts" data="{{districtNameData}}"
                            order-by-child="district_name">
            </firebase-query>

            <!--query for data header titles-->
            <firebase-query id="header_title_queryu" path="header_titles" data="{{headerTitleData}}">
            </firebase-query>

            <!-- Layout for the side slide-out menu, force-narrow lets the menu slide in and out on larger screens -->
            <app-drawer-layout force-narrow>
                <!-- Layout for the header-->
                <app-header-layout>

                    <app-header
                            condenses="[[condenses]]"
                            fixed="[[fixed]]"
                            reveals="[[reveals]]"
                            shadow="[[shadow]]"
                            effects="[[_computeEffects(blendBackground, fadeBackground, parallaxBackground, resizeSnappedTitle, resizeTitle, waterfall)]]"
                            slot="header">

                        <app-toolbar>
                            <div condensed-title>School Disbursements</div>
                        </app-toolbar>

                        <app-toolbar></app-toolbar>

                        <app-toolbar>
                            <div main-title spacer>Michigan Lottery Disbursements to Public Schools</div>
                        </app-toolbar>

                        <div id="copyright">
                            Image Info: By <a href="//commons.wikimedia.org/wiki/User:Dehk" title="User:Dehk">Dehk</a> -
                            <span class="int-own-work" lang="en">Own work</span>, <a
                                href="http://creativecommons.org/licenses/by/3.0"
                                title="Creative Commons Attribution 3.0">CC
                            BY 3.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=4683886">Link</a>
                        </div>
                    </app-header>

                </app-header-layout>

            </app-drawer-layout>


            <!-- Div which contains the main content (Map and side panel with charts)-->
            <div id="main" class="layout vertical style-scope lay-out">

                <div class="layout horizontal around-justified">

                    <div class="layout horizontal start-justified">
                        <paper-card id="map_card">
                            <div class="card-content">
                                <div id="mapEle">

                                </div>
                            </div>
                        </paper-card>
                    </div>
                        <div id="filters" class="layout vertical justified style-scope lay-out">

                            <div class="style-scope lay-out">
                            <div id="filter_heading_cont" class="layout horizontal center-justified">
                                <paper-card id="filter_heading" heading="Filters"></paper-card>
                            </div>
                            </div>

                            <div class="style-scope lay-out">
                            <paper-card id="income_filters" heading="Median Household Income" class="fix_z_index_for_click">
                                <div class="card-content">
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        <paper-range-slider always-show-pin id="incomeSlider" step="5"></paper-range-slider>
                                    </div>
                                </div>
                            </paper-card>
                            </div>

                            <div class="style-scope lay-out">
                            <paper-card id="race_filters" heading="Race" class="fix_z_index_for_click">
                                <div class="card-content">
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        % Asian:
                                        <paper-range-slider always-show-pin id="percentAsianSlider"
                                                            step="1"></paper-range-slider>
                                    </div>
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        % Black:
                                        <paper-range-slider always-show-pin id="percentBlackSlider"
                                                            step="1"></paper-range-slider>
                                    </div>
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        % Latino:
                                        <paper-range-slider always-show-pin id="percentLatinoSlider"
                                                            step="1"></paper-range-slider>
                                    </div>
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        % White:
                                        <paper-range-slider always-show-pin id="percentWhiteSlider"
                                                            step="1"></paper-range-slider>
                                    </div>
                                </div>
                            </paper-card>
                            </div>

                            <div class="style-scope lay-out">
                            <paper-card id="funding_filters" heading="$ Spent/School Funding Received"
                                        class="fix_z_index_for_click">
                                <div class="card-content">
                                    <br>
                                    <div class="layout horizontal center-justified">
                                        <paper-range-slider always-show-pin id="spentToReceivedSlider"
                                                            step="1"></paper-range-slider>
                                    </div>
                                </div>
                            </paper-card>
                            </div>

                    </div>

                </div>

                <div class="layout horizontal around-justified">
                <paper-card id="school_district_card" class="">
                    <div class="card-content">
                        <div class="layout horizontal justified style-scope lay-out">
                            <div class="style-scope lay-out">
                                <paper-dropdown-menu id="name_dropdown_list" label="District Name">
                                    <paper-listbox slot="dropdown-content" class="dropdown-content">
                                        <template is="dom-repeat" items="[[districtNameData]]" as="d">
                                            <paper-item>[[d.district_name]]</paper-item>
                                        </template>
                                    </paper-listbox>
                                </paper-dropdown-menu>
                            </div>
                            <div class="style-scope lay-out">
                                <paper-button id="select_district_button">
                                    Select District
                                </paper-button>
                            </div>

                        </div>

                        <template is="dom-repeat" items="[[headerTitleData]]" as="titles">
                            <div class="layout vertical style-scope lay-out">
                                <paper-card class="detail_cards" heading=[[titles.estimate_income]]>
                                    <div class="card-content detail_card_content">
                                        <div id="estimate_income_content"
                                             class="layout horizontal center-justified">
                                            $10,000
                                        </div>
                                    </div>
                                </paper-card>

                                <div class="layout horizontal start justified style-scope lay-out">
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards"
                                                    heading=[[titles.money_spent_funding_received]]>
                                            <div class="card-content detail_card_content">
                                                <div id="money_spent_content"
                                                     class="layout horizontal center-justified">
                                                    $20,000
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards"
                                                    heading=[[titles.total_lottery_received]]>
                                            <div class="card-content detail_card_content">
                                                <div id="total_lottery_received_content"
                                                     class="layout horizontal center-justified">
                                                    $5,000
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                </div>

                                <div class="layout horizontal start justified style-scope lay-out">
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards"
                                                    heading=[[titles.total_lottery_spending]]>
                                            <div class="card-content detail_card_content">
                                                <div id="total_lottery_spending_content"
                                                     class="layout horizontal center-justified">
                                                    $40,000
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards" heading=[[titles.estimate_total]]>
                                            <div class="card-content detail_card_content">
                                                <div id="estimate_total_content"
                                                     class="layout horizontal center-justified">
                                                    600
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards" heading=[[titles.total_students]]>
                                            <div class="card-content detail_card_content">
                                                <div id="total_students_content"
                                                     class="layout horizontal center-justified">
                                                    875
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                </div>
                                <div class="layout horizontal justified style-scope lay-out">
                                    <div id="details" class="style-scope lay-out">

                                        <paper-card class="detail_cards" heading=[[titles.percent_asian]]>
                                            <div class="card-content detail_card_content">
                                                <div id="percent_asian_content"
                                                     class="layout horizontal center-justified">
                                                    30%
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards" heading=[[titles.percent_black]]>
                                            <div class="card-content detail_card_content">
                                                <div id="percent_black_content"
                                                     class="layout horizontal center-justified">
                                                    40%
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards" heading=[[titles.percent_latino]]>
                                            <div class="card-content detail_card_content">
                                                <div id="percent_latino_content"
                                                     class="layout horizontal center-justified">
                                                    20%
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                    <div class="style-scope lay-out">
                                        <paper-card class="detail_cards" heading=[[titles.percent_white]]>
                                            <div class="card-content detail_card_content">
                                                <div id="percent_white_content"
                                                     class="layout horizontal center-justified">
                                                    10%
                                                </div>
                                            </div>
                                        </paper-card>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </paper-card>


                <paper-card id=dataCard" class="">

                    <div class="card-content">
                        <h2 id="distName"></h2>
                        <iron-icon on-click="_goPrev" id='navLeft' icon="icons:chevron-left"></iron-icon>
                        <iron-icon on-click="_goNext" id='navRight' icon="icons:chevron-right"></iron-icon>
                        <iron-pages id="pages" selected="0">
                            <section>
                                <canvas id="inVsOut"></canvas>
                            </section>
                            <section>
                                <canvas id="demographics"></canvas>
                            </section>
                        </iron-pages>
                    </div>
                </paper-card>
                </div>


            </div>
        </template>


        <script>


            /**
             * @customElement
             * @polymer
             */
            class MyLotto extends Polymer.Element {
                static get is() {
                    return 'my-lotto';
                }

                static get properties() {
                    return {
                        myVal: {
                            type: Boolean,
                            value: true
                        },
                        myVal2: {
                            type: Number,
                            value: 0
                        },
                        condenses: {
                            type: Boolean,
                            value: true
                        },
                        fixed: {
                            type: Boolean,
                            value: true
                        },
                        reveals: {
                            type: Boolean,
                            value: false
                        },
                        shadow: {
                            type: Boolean,
                            value: false
                        },
                        blendBackground: {
                            type: Boolean,
                            value: true
                        },
                        fadeBackground: {
                            type: Boolean,
                            value: false
                        },
                        parallaxBackground: {
                            type: Boolean,
                            value: true
                        },
                        resizeSnappedTitle: {
                            type: Boolean,
                            value: false
                        },
                        resizeTitle: {
                            type: Boolean,
                            value: true
                        },
                        waterfall: {
                            type: Boolean,
                            value: true
                        },
                        i1dis: {
                            type: Boolean,
                            value: false
                        },
                        user: {
                            type: Object
                        }
                    }
                };


                applyFilters() {

                    //TODO make this somewhere else eventually
                    //deselect current school district
                    var dropdown = this.$.name_dropdown_list;
                    dropdown._setSelectedItem(null);

                    var districtNames = [];
                    var inVsOut = this.$.inVsOut;
                    var demographics = this.$.demographics;
                    var districtNameHeader = this.$.distName;

                    //query and filter
                    var results = [];
                    var estimated_income_query = 10;
                    var estimated_black_query = 50;
                    var estimated_asian_query = 1.3;
                    var money_spent_to_received_query = 0;

                    console.log("incomemin: " + incomeMin);

                    if (rootRef != undefined) {
                        rootRef.once("value", function (snapshot) {
                            snapshot.forEach(function (childSnapshot) {




                                if (childSnapshot.val().estimate_income >= (incomeMin * 1000) &&
                                    childSnapshot.val().estimate_income <= incomeMax * 1000 &&
                                    childSnapshot.val().percent_black >= blackMin &&
                                    childSnapshot.val().percent_black <= blackMax &&
                                    childSnapshot.val().percent_asian >= asianMin &&
                                    childSnapshot.val().percent_asian <= asianMax &&
                                    childSnapshot.val().percent_white >= whiteMin &&
                                    childSnapshot.val().percent_white <= whiteMax &&
                                    childSnapshot.val().percent_latino >= latinoMin &&
                                    childSnapshot.val().percent_latino <= latinoMax &&
                                    childSnapshot.val().money_spent_funding_received >= spentReceivedMin &&
                                    childSnapshot.val().money_spent_funding_received <= spentReceivedMax) {

                                    results.push(childSnapshot);
                                    console.log(childSnapshot.val().district_name);
                                }
                            });

                            results.forEach(function (entry) {
                                districtNames.push(entry.val().district_name);
                            });

                            console.log("District Names:" + districtNames.length);

                            //update map
                            if (map != undefined) {
                                map.data.setStyle(function (feature) {

                                    //to fix inconsistencies later use FIPSCODE instead of NAME
                                    //'Id2' on data given to us

                                    var name = feature.getProperty('NAME');

                                    if (districtNames.includes(name)) {
                                        var color = 'red';
                                        return {
                                            fillColor: color,
                                            strokeWeight: .3,
                                            clickable: true
                                        };
                                    } else {
                                        return {
                                            strokeWeight: .3,
                                            clickable: false
                                        };
                                    }
                                });


                                /*code below is good */

                                map.data.addListener('mouseover', function (event) {
                                    map.data.overrideStyle(event.feature, {strokeWeight: 1.3, strokeColor: 'red'});
                                });

                                map.data.addListener('mouseout', function (event) {
                                    map.data.revertStyle();
                                });

                                //add onClick handler
                                map.data.addListener('click', function (event) {
                                    var districtChosen = event.feature.getProperty('NAME');
                                    currentDistrict = districtChosen;
                                    //alert(districtChosen);
                                    //var districtRef = rootRef.child(districtChosen);

                                    var arr = [];
                                    rootRef.orderByChild('district_name').equalTo(districtChosen).limitToFirst(1).once("value", function (snapshot) {
                                        snapshot.forEach(function (childSnapshot) {
                                            arr.push(childSnapshot.val().district_name);
                                            arr.push(childSnapshot.val().total_lottery_spending);
                                            arr.push(childSnapshot.val().total_lottery_received);
                                            arr.push(childSnapshot.val().percent_white);
                                            arr.push(childSnapshot.val().percent_asian);
                                            arr.push(childSnapshot.val().percent_black);
                                            arr.push(childSnapshot.val().percent_latino);
                                        });


                                        //Update H2 with selected district name
                                        districtNameHeader.innerText = arr[0];

                                        //update bar graph
                                        var ctx = inVsOut.getContext('2d');

                                        if (barChart != undefined)
                                            barChart.destroy();

                                        barChart = new Chart(ctx, {
                                            type: 'bar',

                                            data: {
                                                labels: ["Money Spent", "Money Received"],
                                                datasets: [{
                                                    labels: arr[0],
                                                    backgroundColor: ["#ff0000", "#00CC00"],
                                                    data: [arr[1], arr[2]]
                                                }]
                                            },

                                            options: {
                                                legend: {
                                                    display: false
                                                }
                                            }
                                        });

                                        //update demographics chart
                                        var demoCtx = demographics.getContext("2d");
                                        var data;
                                        if (demoChart != undefined)
                                            demoChart.destroy();
                                        demoChart = new Chart(demoCtx, {
                                            type: 'pie',
                                            data: data = {
                                                datasets: [{
                                                    data: [arr[3], arr[4], arr[5], arr[6]],
                                                    backgroundColor: ["#ff8b8b", "#aeffe1", "#006eff", "#c5cc87"]
                                                }],
                                                // These labels appear in the legend and in the tooltips when hovering different arcs
                                                labels: [
                                                    '% White',
                                                    '% Asian',
                                                    '% Black',
                                                    '% Latino'
                                                ]
                                            },
                                            options: {
                                                responsive: false,
                                                maintainAspectRatio: true,
                                                cutoutPercentage: 50,
                                                animation: {
                                                    animateRotate: true
                                                }
                                            }

                                        });
                                    }); //update map


                                });
                            }

                        });
                    }
                }

                getThis(){
                    return this;
                }

                //Runs one time, when the DOM is fully loaded. Renders the map for the first time.
                ready() {
                    super.ready();

                    //listen for changes
                    // this.$.incomeSlider.addEventListener('updateValues', function (customEvent) {
                    //     //console.log(' - current min/max values: ', this.valueMin, this.valueMax)
                    // });
                    // this.$.incomeSlider.addEventListener('mousedown', function (customEvent) {
                    //     //get current value
                    //     console.log(customEvent.target.valueMax);
                    //
                    //
                    // });

                    //variable for this keyword
                    var app = this.getThis();

                    //update map when sliders are adjusted
                    this.$.incomeSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;
                        //console.log("slidermin" + sliderMin);


                        if(sliderMin != incomeMin || sliderMax != incomeMax){
                            incomeMin = sliderMin;
                            incomeMax = sliderMax;
                            app.applyFilters();
                        }
                    });
                    this.$.percentAsianSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;


                        if(sliderMin != asianMin || sliderMax != asianMax){
                            asianMin = sliderMin;
                            asianMax = sliderMax;
                            app.applyFilters();
                        }
                    });
                    this.$.percentBlackSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;


                        if(sliderMin != blackMin || sliderMax != blackMax){
                            blackMin = sliderMin;
                            blackMax = sliderMax;
                            app.applyFilters();
                        }
                    });
                    this.$.percentLatinoSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;


                        if(sliderMin != latinoMin || sliderMax != latinoMax){
                            latinoMin = sliderMin;
                            latinoMax = sliderMax;
                            app.applyFilters();
                        }
                    });
                    this.$.percentWhiteSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;


                        if(sliderMin != whiteMin || sliderMax != whiteMax){
                            whiteMin = sliderMin;
                            whiteMax = sliderMax;
                            app.applyFilters();
                        }
                    });
                    this.$.spentToReceivedSlider.addEventListener('mouseup', function (customEvent) {
                        //check if changed
                        var sliderMin = customEvent.target.valueMin;
                        var sliderMax = customEvent.target.valueMax;


                        if(sliderMin != spentReceivedMin || sliderMax != spentReceivedMax){
                            spentReceivedMin = sliderMin;
                            spentReceivedMax = sliderMax;
                            app.applyFilters();
                        }
                    });


                    //setup pin values for sliders
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.incomeSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `$${value}K`
                        }
                    });
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.percentWhiteSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `${value}%`
                        }
                    });
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.percentAsianSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `${value}%`
                        }
                    });
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.percentBlackSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `${value}%`
                        }
                    });
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.percentLatinoSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `${value}%`
                        }
                    });
                    window.addEventListener('WebComponentsReady', () => {
                        // get the element
                        let slider = this.$.spentToReceivedSlider;
                        // assign the display function that is called for every value
                        slider.displayFunction = function (value) {
                            // format the value
                            return `$${value}`
                        }
                    });


                    rootRef = firebase.database().ref();

                    map = new google.maps.Map(this.$.mapEle, {
                        center: {lat: 44.5, lng: -86},
                        zoom: 7,
                        styles: [{featureType: "road", stylers: [{visibility: "off"}]}, {},
                            {featureType: "poi", stylers: [{visibility: "off"}]}, {},
                            {featureType: "administrative", stylers: [{visibility: "off"}]}, {}]
                    });
                    map.data.loadGeoJson("src/simplified.json");

                    map.data.setStyle(function (feature) {
                        return {
                            strokeWeight: .3
                        }
                    });
                };

                _computeEffects() {
                    return [
                        this.blendBackground ? 'blend-background ' : '',
                        this.fadeBackground ? 'fade-background ' : '',
                        this.parallaxBackground ? 'parallax-background ' : '',
                        this.resizeSnappedTitle ? 'resize-snapped-title ' : '',
                        this.resizeTitle ? 'resize-title ' : '',
                        this.waterfall ? 'waterfall ' : ''
                    ].join('');
                };

                _removeIf(propName, value) {
                    if (this[propName] && value) {
                        this[propName] = false;
                    }
                };

                _goPrev() {
                    this.$.pages.selectPrevious();
                }

                _goNext() {
                    this.$.pages.selectNext();
                }

                static getMyVal() {
                    return this;
                }

                //TODO OG CODE BELOW
                // applyFilters() {
                //
                //     var districtNames = [];
                //     var incomeMin;
                //     var incomeMax;
                //     var raceMin;
                //     var raceMax;
                //     var ratioMin;
                //     var ratioMax;
                //     var inVsOut = this.$.inVsOut;
                //     var demographics = this.$.demographics;
                //     var districtNameHeader = this.$.distName;
                //     //var arr = [];
                //
                //     //get the states of the checkboxes
                //     var incomeBoxStates = [];
                //     incomeBoxStates.push(this.$.i1.checked);
                //     incomeBoxStates.push(this.$.i2.checked);
                //     incomeBoxStates.push(this.$.i3.checked);
                //     incomeBoxStates.push(this.$.i4.checked);
                //
                //     var raceBoxStates = [];
                //     raceBoxStates.push(this.$.r0.checked);
                //     raceBoxStates.push(this.$.r1.checked);
                //     raceBoxStates.push(this.$.r2.checked);
                //     raceBoxStates.push(this.$.r3.checked);
                //     raceBoxStates.push(this.$.r4.checked);
                //
                //     var ratioBoxStates = [];
                //     ratioBoxStates.push(this.$.ratio0.checked);
                //     ratioBoxStates.push(this.$.ratio1.checked);
                //     ratioBoxStates.push(this.$.ratio2.checked);
                //     ratioBoxStates.push(this.$.ratio3.checked);
                //     ratioBoxStates.push(this.$.ratio4.checked);
                //     ratioBoxStates.push(this.$.ratio5.checked);
                //     ratioBoxStates.push(this.$.ratio6.checked);
                //
                //     //get the income range to query on firebase
                //     if (incomeBoxStates != undefined && incomeBoxStates.includes(true)) {
                //         incomeMin = Number.MAX_VALUE;
                //         incomeMax = Number.MIN_VALUE;
                //         for (var i = 0; i < incomeBoxStates.length; ++i) {
                //             if (incomeBoxStates[i]) {
                //                 if (incomeMin > incomeValues[i][0])
                //                     incomeMin = incomeValues[i][0];
                //                 if (incomeMax < incomeValues[i][1])
                //                     incomeMax = incomeValues[i][1];
                //             }
                //         }
                //     }
                //     //get the race range to query on firebase
                //     if (raceBoxStates != undefined && raceBoxStates.includes(true)) {
                //         raceMin = Number.MAX_VALUE;
                //         raceMax = Number.MIN_VALUE;
                //         for (var i = 0; i < raceBoxStates.length; ++i) {
                //             if (raceBoxStates[i]) {
                //                 if (raceMin > raceValues[i][0])
                //                     raceMin = raceValues[i][0];
                //                 if (raceMax < raceValues[i][1])
                //                     raceMax = raceValues[i][1];
                //             }
                //         }
                //
                //     }
                //     //get the ratio range to query on firebase
                //     if (ratioBoxStates != undefined && ratioBoxStates.includes(true)) {
                //         ratioMin = Number.MAX_VALUE;
                //         ratioMax = Number.MIN_VALUE;
                //         for (var i = 0; i < ratioBoxStates.length; ++i) {
                //             if (ratioBoxStates[i]) {
                //                 if (ratioMin > ratioValues[i][0])
                //                     ratioMin = ratioValues[i][0];
                //                 if (ratioMax < ratioValues[i][1])
                //                     ratioMax = ratioValues[i][1];
                //             }
                //         }
                //
                //     }
                //
                //     //decide which category to filter by
                //     var queryCategory = "estimate_income";
                //     var queryMin = 0;
                //     var queryMax = 0;
                //
                //     if (incomeBoxStates.includes(true)) {
                //         queryMin = incomeMin;
                //         queryMax = incomeMax;
                //     }
                //     else if (raceBoxStates.includes(true)) {
                //         queryCategory = "percent_black";
                //         queryMin = raceMin;
                //         queryMax = raceMax;
                //     }
                //     else if (ratioBoxStates.includes(true) && !raceBoxStates.includes(true)) {
                //         queryCategory = "money_spent_funding_received";
                //         queryMin = ratioMin;
                //         queryMax = ratioMax;
                //     }
                //
                //     //query and filter
                //     var results = [];
                //     if (rootRef != undefined) {
                //         rootRef.orderByChild(queryCategory).startAt(queryMin).endAt(queryMax).once("value", function (snapshot) {
                //             snapshot.forEach(function (childSnapshot) {
                //
                //
                //                 if (queryCategory == "estimate_income") {
                //                     if (raceBoxStates.includes(true) && ratioBoxStates.includes(true)) {
                //                         if (childSnapshot.val().percent_black <= raceMax) {
                //                             if (childSnapshot.val().percent_black >= raceMin) {
                //                                 if (childSnapshot.val().money_spent_funding_received <= ratioMax) {
                //                                     if (childSnapshot.val().money_spent_funding_received >= ratioMin) {
                //                                         console.log(childSnapshot.val().percent_black);
                //                                         results.push(childSnapshot);
                //                                     }
                //                                 }
                //                             }
                //                         }
                //                     }
                //                     else if (raceBoxStates.includes(true)) {
                //                         if (childSnapshot.val().percent_black <= raceMax) {
                //                             if (childSnapshot.val().percent_black >= raceMin) {
                //                                 console.log(childSnapshot.val().percent_black);
                //                                 results.push(childSnapshot);
                //                             }
                //                         }
                //                     }
                //                     else if (ratioBoxStates.includes(true)) {
                //                         if (childSnapshot.val().money_spent_funding_received <= ratioMax) {
                //                             if (childSnapshot.val().money_spent_funding_received >= ratioMin) {
                //                                 console.log(childSnapshot.val().money_spent_funding_received);
                //                                 results.push(childSnapshot);
                //                             }
                //
                //                         }
                //
                //                     }
                //                     else {
                //                         results.push(childSnapshot);
                //                     }
                //
                //
                //                 } else if (queryCategory == "percent_black") {
                //                     if (ratioBoxStates.includes(true)) {
                //                         if (childSnapshot.val().money_spent_funding_received <= ratioMax) {
                //                             if (childSnapshot.val().money_spent_funding_received >= ratioMin) {
                //                                 console.log("Ratio: " + childSnapshot.val().money_spent_funding_received + " Race: " + childSnapshot.val().percent_black);
                //                                 results.push(childSnapshot);
                //                             }
                //                         }
                //                     } else {
                //                         results.push(childSnapshot);
                //                     }
                //                 } else {
                //                     results.push(childSnapshot);
                //                 }
                //             });
                //
                //             results.forEach(function (entry) {
                //                 districtNames.push(entry.val().district_name);
                //             });
                //
                //             console.log("District Names:" + districtNames.length);
                //         });
                //     }
                //
                //
                //     //update map
                //     if (map != undefined) {
                //         map.data.setStyle(function (feature) {
                //             var name = feature.getProperty('NAME');
                //
                //             if (districtNames.includes(name)) {
                //                 var color = 'red';
                //                 return {
                //                     fillColor: color,
                //                     strokeWeight: .3,
                //                     clickable: true
                //                 };
                //             } else {
                //                 return {
                //                     strokeWeight: .3,
                //                     clickable: false
                //                 };
                //             }
                //         });
                //
                //         map.data.addListener('mouseover', function (event) {
                //             map.data.overrideStyle(event.feature, {strokeWeight: 1.3, strokeColor: 'red'});
                //         });
                //
                //         map.data.addListener('mouseout', function (event) {
                //             map.data.revertStyle();
                //         });
                //
                //         //add onClick handler
                //         map.data.addListener('click', function (event) {
                //             var districtChosen = event.feature.getProperty('NAME');
                //             currentDistrict = districtChosen;
                //             //alert(districtChosen);
                //             //var districtRef = rootRef.child(districtChosen);
                //
                //             var arr = [];
                //             rootRef.orderByChild('district_name').equalTo(districtChosen).limitToFirst(1).once("value", function (snapshot) {
                //                 snapshot.forEach(function (childSnapshot) {
                //                     arr.push(childSnapshot.val().district_name);
                //                     arr.push(childSnapshot.val().total_lottery_spending);
                //                     arr.push(childSnapshot.val().total_lottery_received);
                //                     arr.push(childSnapshot.val().percent_white);
                //                     arr.push(childSnapshot.val().percent_asian);
                //                     arr.push(childSnapshot.val().percent_black);
                //                     arr.push(childSnapshot.val().percent_latino);
                //                 });
                //
                //                 //console.log("Inside: " + typeof(arr[1]));
                //                 /*$('#inVsOut').remove();
                //                 $('#graphContainer').append('<canvas id="inVsOut"></canvas>');
                //                 console.log(typeof(arr[1]));*/
                //                 //console.log(arr[2]);
                //
                //                 //Update H2 with selected district name
                //                 districtNameHeader.innerText = arr[0];
                //
                //                 //update bar graph
                //                 var ctx = inVsOut.getContext('2d');
                //
                //                 if (barChart != undefined)
                //                     barChart.destroy();
                //
                //                 barChart = new Chart(ctx, {
                //                     type: 'bar',
                //
                //                     data: {
                //                         labels: ["Money Spent", "Money Received"],
                //                         datasets: [{
                //                             labels: arr[0],
                //                             backgroundColor: ["#ff0000", "#00CC00"],
                //                             data: [arr[1], arr[2]]
                //                         }]
                //                     },
                //
                //                     options: {
                //                         legend: {
                //                             display: false
                //                         }
                //                     }
                //                 });
                //
                //                 //update demographics chart
                //                 var demoCtx = demographics.getContext("2d");
                //                 var data;
                //                 if (demoChart != undefined)
                //                     demoChart.destroy();
                //                 demoChart = new Chart(demoCtx, {
                //                     type: 'pie',
                //                     data: data = {
                //                         datasets: [{
                //                             data: [arr[3], arr[4], arr[5], arr[6]],
                //                             backgroundColor: ["#ff8b8b", "#aeffe1", "#006eff", "#c5cc87"]
                //                         }],
                //                         // These labels appear in the legend and in the tooltips when hovering different arcs
                //                         labels: [
                //                             '% White',
                //                             '% Asian',
                //                             '% Black',
                //                             '% Latino'
                //                         ]
                //                     },
                //                     options: {
                //                         responsive: false,
                //                         maintainAspectRatio: true,
                //                         cutoutPercentage: 50,
                //                         animation: {
                //                             animateRotate: true
                //                         }
                //                     }
                //
                //                 });
                //             }); //update map
                //
                //
                //         });
                //     }
                //
                // }


                //Disregard for now

                checkBoxChecked(ev) {

                    /*var results = []                                                                                                                                                                                                                            ;
                    rootRef.orderByChild("percent_black").endAt(1).once("value", function(snapshot){
                        snapshot.forEach(function(childSnapshot){
                            results.push(childSnapshot);
                            console.log(results.length)


                        });

                    });*/

                    //alert(ev.target.checked);
                    //var other = this.$.i2;
                    //other.disabled = true;
                    //alert(other.checked);

                    /*  var map = new google.maps.Map(this.$.mapEle, {
                          center: {lat: 44.5, lng: -84.5555},
                          zoom: 7,
                          styles: [ { featureType: "road", stylers: [ { visibility: "off" } ] },{ },
                              { featureType: "poi", stylers: [ { visibility: "off" } ] },{ },
                              { featureType: "administrative", stylers: [ { visibility: "off" } ] },{ }]
                      });
                      map.data.loadGeoJson("src/simplified.json");

                      map.data.setStyle(function(feature) {
                          var name = feature.getProperty('NAME');
                          if (name == "Alcona Community Schools") {
                              var color = 'red';
                              return {
                                  fillColor: color,
                                  strokeWeight: .7
                              };
                          } else {
                              return {
                                  strokeWeight: .3,
                                  fillColor: 'blue'
                              };
                          }
                      });*/
                };

                /*signs user out.... obviously*/
//            signOutFirebase() {
//                var favContent = this.$.favContent;
//                firebase.auth().signOut().then(function () {
//                    au.hidden = true;
//                    nonau.hidden = false;
//                    favContent.innerHTML = "Sign in to view favorites."
//
//                }).catch(function (error) {
//                    alert("Sorry, there was an error signing you out");
//                });
//            }


            }


            window.customElements.define(MyLotto.is, MyLotto);
            window.customElements.forcePolyfill = true;

            //                console.log(this.districtNameData.child());
            //
            //                //populate dropdown list
            //                var district_name_list = [];
            //                //var for drop down box
            //                var dropDownBox = this.$.district_name_box;
            //
            //                rootRef.orderByChild('district_name').once("value", function (snapshot) {
            //                    snapshot.forEach(function (childSnapshot) {
            //                        district_name_list.push(childSnapshot.val().district_name);
            //                        //first few nodes are undefined because they are not part of the data set
            //                        if(childSnapshot.val().district_name){
            ////                            console.log(childSnapshot.val().district_name);
            //
            //                        }
            //                    });
            //                    console.log(district_name_list.length);
            ////                    dropDownBox.appendChild
            ////                    console.log(district_name_list);
            //                });
            //
            ////
            //////                dropDownBox.innerHTML = "";
            //////                for(var i = 0; i < district_name_list.length; i++){
            ////                    dropDownBox.innerHTML = "ssdf";
            //////                }
            //
            //
            //
            //                /**************************************
            //                 * not in use but keeping around for reference for now- zack
            //                 *
            //                 *
            //                 *
            //                 * *************************************/
            ////                currentUid;
            ////                var poly = this;
            ////                var signOutButton = this.$.signOutButton;
            ////                var userGreeting = this.$.username;
            ////                signInContainer = this.$.signInContainer;
            ////                var favCard = this.$.favCard;
            ////                var favContent = this.$.favContent;
            ////
            ////                nonau = this.$.signInContainer;
            ////                au = this.$.authUsers;
            ////
            ////                if (currentUid == null) {
            ////                    currentUid = null;
            ////                    au.hidden = true;
            ////                    nonau.hidden = false;
            ////                    console.log("nobody signed in");
            ////                } else {
            ////                    userGreeting.innerText = "Hello " + user.displayName;
            ////                    au.hidden = false;
            ////                    nonau.hidden = true;
            ////                    console.log(user.displayName + ' is signed in');
            ////
            ////                }
            ////
            ////                firebase.auth().onAuthStateChanged(function (user) {
            ////
            ////                    if (user && user.uid != currentUid) {
            ////                        currentUid = user.uid;
            ////                        currentUser = user;
            ////
            ////
            ////                        if (user == null) {
            ////                            currentUid = null;
            ////                            au.hidden = true;
            ////                            nonau.hidden = false;
            ////                            console.log("nobody signed in");
            ////                            favContent.innerHTML = "Please sign in to view favorites."
            ////                        } else {
            ////                            rootRef.child("users").child(user.uid).update({
            ////                                name: user.displayName,
            ////                            });
            ////
            ////                            userGreeting.innerText = "Hello " + user.displayName;
            ////                            au.hidden = false;
            ////                            nonau.hidden = true;
            ////                            console.log(user.displayName + ' is signed in');
            ////                            favContent.innerHTML = "";
            ////                            rootRef.child("users").child(firebase.auth().currentUser.uid).child("favorites").orderByChild("ditrict_name").once("value", function (snapshot) {
            ////                                snapshot.forEach(function (childSnapshot) {
            ////                                    favContent.insertAdjacentHTML("beforeend", childSnapshot.val().district_name + "</br>");
            ////                                });
            ////
            ////                            });
            ////                        }
            ////                    }
            ////                });
            ////                var uiConfig = {
            ////                    signInSuccessUrl: "http://cis.gvsu.edu/~amesm/lotteryv2/",
            ////                    signInFlow: 'popup',
            ////                    signInOptions: [
            ////                        firebase.auth.GoogleAuthProvider.PROVIDER_ID
            ////                    ],
            ////                    // Terms of service url can be specified and will show up in the widget.
            ////                    tosUrl: '<your-tos-url>'
            ////                };
            ////                /*  if (ui != null)
            ////                      ui.reset();*/
            ////                ui = new firebaseui.auth.AuthUI(firebase.auth());
            ////                // The start method will wait until the DOM is loaded.
            ////                ui.start(signInContainer, uiConfig);
            //
        </script>

    </dom-module>





